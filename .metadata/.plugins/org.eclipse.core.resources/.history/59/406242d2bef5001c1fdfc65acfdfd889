package days10.replyboard.persistence;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.util.JdbcUtil;

import days10.replyboard.domain.ReplyBoardDTO;

public class ReplyBoardDAO implements IReplyBoard{

   // 1. 싱글톤
   private ReplyBoardDAO() {}
   private static ReplyBoardDAO instance = new ReplyBoardDAO();
   public static ReplyBoardDAO getInstance() {
      return instance;
   }

   @Override
   public List<ReplyBoardDTO> selectList(Connection con) throws SQLException {

      String sql =
            " select rownum rnum, num,writer,email,subject,pass, regdate,readcount,ref,step,depth,content,ip "
                  +  ", case       when ( sysdate - regdate ) < 0.041667  then  'true'      else 'false'      end  new "
                  + " from replyboard "
                  +" order by ref desc, step asc";
      
      ArrayList<ReplyBoardDTO> list = null;
      PreparedStatement pstmt = null;
      ResultSet rs = null;

      try {
         pstmt = con.prepareStatement(sql);
         rs = pstmt.executeQuery();
         if ( rs.next() ) {
            list = new ArrayList<ReplyBoardDTO>();
            ReplyBoardDTO dto = null;
            do {
               dto =  new ReplyBoardDTO();

               dto.setNum( rs.getInt("num") );
               dto.setWriter( rs.getString("writer"));
               dto.setEmail( rs.getString("email"));
               dto.setSubject( rs.getString("subject"));   
               dto.setReadcount( rs.getInt("readcount"));
               dto.setRegdate(rs.getDate("regdate"));
               dto.setIp( rs.getString("ip"));               
               dto.setRef( rs.getInt("ref"));         // X
               dto.setStep( rs.getInt("step"));     // X
               dto.setDepth(rs.getInt("depth"));
               dto.setNewImg( new Boolean(rs.getString("new")) );

               list.add(dto);
            } while ( rs.next() );
         } // 
      } finally {
         JdbcUtil.close(pstmt);
         JdbcUtil.close(rs);         
      } // finally

      return list;
   }

   @Override
   public int insert(Connection con, ReplyBoardDTO dto) throws SQLException {

      return 0;
   }

   @Override
   public int updateReadCount(Connection con, int num) throws SQLException {

      return 0;
   }

   @Override
   public ReplyBoardDTO selectOne(Connection con, int num) throws SQLException {

      return null;
   }

   @Override
   public int updateRefStep(Connection con, int parentRef, int parentStep) throws SQLException {

      return 0;
   }

   @Override
   public int delete(Connection con, int num) throws SQLException {

      return 0;
   }

}